{"version":3,"file":"index.js","mappings":"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","sources":["webpack://k6-jslib-utils/webpack/bootstrap","webpack://k6-jslib-utils/webpack/runtime/compat get default export","webpack://k6-jslib-utils/webpack/runtime/define property getters","webpack://k6-jslib-utils/webpack/runtime/hasOwnProperty shorthand","webpack://k6-jslib-utils/webpack/runtime/make namespace object","webpack://k6-jslib-utils/external commonjs \"k6/execution\"","webpack://k6-jslib-utils/./src/stages.js","webpack://k6-jslib-utils/./src/utils.js"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"k6/execution\");","import exec from 'k6/execution'\n\n// parseDuration parses the provided string as an Integer number\n// in millisecond precision\nfunction parseDuration(str) {\n\tif (str == null || str.length < 1) {\n\t\tthrow new Error('str is empty')\n\t}\n\n\t// the sum in millisecond of the parsed duration\n\tlet d = 0;\n\n\t// current contains the partial seen number\n\t// it's reset when a time unit is found\n\tlet current = '';\n\n\t\n\t// it tracks the seen time units\n\t// and it denies eventual duplicated\n\tlet seen = {}\n\n\tfor (let i = 0; i < str.length; i++) {\n\t\t// append the current char if it's a number or a decimal separator\n\t\tif (isNumber(str[i]) || str[i] == '.') {\n\t\t\tcurrent += str[i]\n\t\t}\n\n\t\t// return if the next char is not a time unit \n\t\tif (str[i+1] == null || isNumber(str[i+1]) || str[i+1] == '.') {\n\t\t\tcontinue\n\t\t}\n\t\n\t\tlet v = parseFloat(current, 10)\n\t\tlet next = str[i+1]\n\t\t\n\t\tswitch (next) {\n\t\t\tcase 'd':\n\t\t\t\td += v*24*60*60*1000\n\t\t\t\tbreak;\n\t\t\tcase 'h':\n\t\t\t\td += v*60*60*1000\n\t\t\t\tbreak;\n\t\t\tcase 'm':\n\t\t\t\tif (i + 2 < str.length && str[i+2] == 's') {\n\t\t\t\t\t// millisecond is the maximum precision\n\t\t\t\t\t// truncate eventual decimal\n\t\t\t\t\td += Math.trunc(v)\n\t\t\t\t\ti++\n\t\t\t\t\tnext = 'ms'\n\t\t\t\t} else {\n\t\t\t\t\td += v*60*1000\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 's':\n\t\t\t\td += v*1000\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tthrow new Error(`${next} is an unsupported time unit`)\n\t\t}\n\t\tif (seen[next]) {\n\t\t\tthrow new Error(`${next} time unit is provided multiple times`)\n\t\t}\n\t\tseen[next] = true\n\t\ti++\n\t\tcurrent = ''\n\t}\n\t// flush in case no time unit has been provided\n\t// for the latest group\n\tif (current.length > 0) {\n\t\td += parseFloat(current, 10)\n\t}\n\treturn d \n}\n\n// isNumber return true if the c character is a number\nfunction isNumber(c) {\n\treturn c >= '0' && c <= '9'\n}\n\n// getCurrentStageIndex returns the computed index of the running stage.\nfunction getCurrentStageIndex() {\n\tif (exec == undefined || exec.test == undefined || exec.test.options == undefined) {\n\t\tthrow new Error(`k6/execution.test.options is undefined - getCurrentStageIndex requires a k6 v0.38.0 or later. Please, upgrade for getting k6/execution.test.options supported.`)\n\n\t}\n\n\tlet scenario = exec.test.options.scenarios[exec.scenario.name]\n\tif (scenario == null)\t{\n\t\tthrow new Error(`the exec.test.options object doesn't contain the current scenario ${exec.scenario.name}`)\n\t}\n\tif (scenario.stages == null) {\n\t\tthrow new Error(`only ramping-vus or ramping-arravial-rate supports stages, it is not possible to get a stage index on other executors.`)\n\t}\n\n\tif (scenario.stages.length < 1) {\n\t\tthrow new Error(`the current scenario ${scenario.name} doesn't contain any stage`)\n\t}\n\n\tlet sum = 0;\n\tlet elapsed = new Date() - exec.scenario.startTime\n\tfor (let i = 0; i < scenario.stages.length; i++) {\n\t\tsum += parseDuration(scenario.stages[i].duration)\n\t\tif (elapsed < sum) {\n\t\t\treturn i\n\t\t}\n\t}\n\n\treturn scenario.stages.length-1\n}\n\n// tagWithCurrentStageIndex adds a tag with a `stage` key\n// and the index of the current running stage as value.\nfunction tagWithCurrentStageIndex() {\n  exec.vu.tags['stage'] = getCurrentStageIndex()\n}\n\n// tagWithCurrentStageProfile adds a tag with a `stage` key\n// and the profile (ramp-up, steady or ramp-down) computed\n// from the current running stage.\nfunction tagWithCurrentStageProfile() {\n  //ramp-up when previous.target < current.target\n  //ramp-down when previous.target > current.target\n  //steady when prevuious.target = current.target\n\t\n\tlet getStageProfile = function() {\t\n\t\tlet currentIndex = getCurrentStageIndex()\n\t\tif (currentIndex < 1) {\n\t\t\treturn 'ramp-up'\n\t\t}\n\n\t\tlet stages = exec.test.options.scenarios[exec.scenario.name].stages\n\t\tlet current = stages[currentIndex]\n\t\tlet previous = stages[currentIndex-1] \n\n\t\tif (current.target  > previous.target) {\n\t\t\treturn 'ramp-up'\n\t\t}\n\t\t\n\t\tif (previous.target == current.target) {\n\t\t\treturn 'steady'\n\t\t}\n\n\t\treturn 'ramp-down'\n\t}\n\n  exec.vu.tags['stage_profile'] = getStageProfile()\n}\n\nexport {\n\tparseDuration,\n\tgetCurrentStageIndex,\n\ttagWithCurrentStageIndex,\n\ttagWithCurrentStageProfile,\n}\n","export function uuidv4() {\n  return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {\n    let r = Math.random() * 16 | 0, v = c === 'x' ? r : (r & 0x3 | 0x8);\n    return v.toString(16);\n  });\n}\n\nexport function randomIntBetween(min, max) { // min and max included\n  return Math.floor(Math.random() * (max - min + 1) + min);\n}\n\nexport function randomItem(arrayOfItems){\n  return arrayOfItems[Math.floor(Math.random() * arrayOfItems.length)];\n}\n\nexport function randomString(length, charset='abcdefghijklmnopqrstuvwxyz') {\n  let res = '';\n  while (length--) res += charset[(Math.random() * charset.length) | 0];\n  return res;\n}\n\nexport function findBetween(content, left, right, repeat = false) {\n  const extracted = [];\n  let doSearch = true;\n  let start, end = 0;\n  \n  while (doSearch) {\n    start = content.indexOf(left);\n    if (start == -1) {\n      break; // no more matches\n    }\n\n    start += left.length;\n    end = content.indexOf(right, start);\n    if (end == -1) {\n      break; // no more matches\n    }\n    let extractedContent = content.substring(start, end);\n\n    // stop here if only extracting one match (default behavior)\n    if (!repeat) {\n      return extractedContent; \n    }\n\n    // otherwise, add it to the array\n    extracted.push(extractedContent);\n    \n    // update the \"cursor\" position to the end of the previous match\n    content = content.substring(end + right.length);\n  }\n\n  return extracted.length ? extracted : null; // return all matches as an array or null\n}\n\nexport function normalDistributionStages(maxVus, durationSeconds, numberOfStages=10) {\n  function normalDensity(mean, scale, x) {\n    return Math.exp(-1 / 2 * Math.pow((x - mean) / scale, 2)) / (scale * Math.sqrt(2 * Math.PI));\n  }\n\n  const mean = 0;\n  const scale = 1;\n  let curve = new Array(numberOfStages + 2).fill(0);\n  let durations = new Array(numberOfStages + 2).fill(Math.ceil(durationSeconds / 6));\n  let k6stages = [];\n\n  for (let i = 0; i <= numberOfStages; i++) {\n    curve[i] = normalDensity(mean, scale, -2 * scale + 4 * scale * i / numberOfStages);\n  }\n\n  let peakDistribution = Math.max(...curve);\n\n  let vus = curve.map(x => Math.round(x * maxVus / peakDistribution));\n\n  for (let j = 1; j <= numberOfStages; j++) {\n    durations[j] = Math.ceil(4 * durationSeconds / (6 * numberOfStages));\n  }\n\n  for (let k = 0; k <= numberOfStages + 1; k++) {\n    k6stages.push({duration: `${durations[k]}s`, target: vus[k]});\n  }\n\n  return k6stages;\n}\n"],"names":["__webpack_require__","module","getter","__esModule","d","a","exports","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","Symbol","toStringTag","value","require","parseDuration","str","length","Error","current","seen","i","isNumber","v","parseFloat","next","Math","trunc","c","getCurrentStageIndex","undefined","exec","scenario","stages","name","sum","elapsed","Date","duration","tagWithCurrentStageIndex","tagWithCurrentStageProfile","currentIndex","previous","target","getStageProfile","uuidv4","replace","r","random","toString","randomIntBetween","min","max","floor","randomItem","arrayOfItems","randomString","charset","res","findBetween","content","left","right","start","repeat","extracted","doSearch","end","indexOf","extractedContent","substring","push","normalDistributionStages","maxVus","durationSeconds","numberOfStages","normalDensity","mean","scale","x","exp","pow","sqrt","PI","curve","Array","fill","durations","ceil","k6stages","peakDistribution","vus","map","round","j","k"],"sourceRoot":""}